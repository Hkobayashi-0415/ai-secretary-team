# 過剰設計削除・調整計画書

**作成日**: 2025年8月17日  
**作成者**: 中野五月（Claude Code）  
**バージョン**: 1.0  
**目的**: ローカル・シングルユーザー環境に最適化するための過剰設計の削除・調整

---

## 1. 削除・調整方針

### 1.1 基本方針
- **前提条件の遵守**: ローカル・シングルユーザー環境（1ユーザー、1万-10万レコード）
- **設計思想の維持**: 実用性優先、基本機能に集中、過剰設計は排除
- **ユーザー体験優先**: 快適性を損なわない範囲での簡素化

### 1.2 判断基準
| カテゴリ | 削除 | 簡素化 | 維持 |
|---------|------|--------|------|
| シングルユーザーに不要 | ✅ | - | - |
| ローカル環境に過剰 | - | ✅ | - |
| ユーザー体験に必要 | - | - | ✅ |
| プロジェクトの核心機能 | - | - | ✅ |

---

## 2. 削除対象（完全削除）

### 2.1 JWT認証システム
**対象ファイル**:
- `docs/01-foundation/technical/03-backend-architecture.md`
  - 111-132行: JWT認証ミドルウェア
  - 726-738行: JWT設定
- `docs/02-implementation/api/01-current-api-specification.md`
  - 認証エンドポイント（/auth/login, /auth/logout等）

**理由**: ローカル環境では認証不要、アプリ起動で自動接続

### 2.2 user_sessionsテーブル
**対象ファイル**:
- `docs/01-foundation/database/01-database-design.md`
  - 82-100行: テーブル定義
  - 969-1009行: セッション管理設計

**理由**: セッション管理不要、同時接続なし

### 2.3 マルチテナント対応
**対象箇所**:
```bash
# 検索コマンド
grep -n "マルチテナント\|multi-tenant" docs/**/*.md
```
- 全ファイルから「マルチテナント」記述を削除
- 「シングルユーザー」に置換

**理由**: 1ユーザー環境に不要

### 2.4 行レベルセキュリティ（RLS）
**対象**: データベース設計書内のRLS記述
**理由**: 要件定義で明示的に「不要」と記載

---

## 3. 簡素化対象（機能縮小）

### 3.1 WebSocket実装
**現在の設計**:
- 負荷分散対応
- 複数サーバー接続
- 接続プール管理
- 複雑なルーティング

**調整後の実装**:
```python
class OptimizedLocalWebSocket:
    """バランスの取れたWebSocket実装"""
    
    # ✅ 維持する機能
    - 自動再接続機能
    - メッセージキューイング
    - イベントベース通信
    - エラーハンドリング
    - ハートビート
    - バイナリデータ対応
    
    # ❌ 削除する機能
    - マルチサーバー対応
    - 負荷分散
    - 分散セッション管理
    - 複雑な権限管理
```

### 3.2 Redis使用範囲
**現在の設計**:
- セッション管理
- 分散キャッシュ
- メッセージキュー
- パブサブ

**調整後**:
- キャッシュのみ（パフォーマンス向上用）
- オプション（なくても動作可能）

### 3.3 RBAC（ロールベースアクセス制御）
**現在の設計**:
- 17種類の詳細な権限
- 複雑な権限継承

**調整後**:
- AI秘書の役割分離のみ（4種類）
  - プロジェクト管理秘書
  - タスク実行秘書
  - 分析レポート秘書
  - 知識管理秘書

---

## 4. 維持対象（変更なし）

### 4.1 AI秘書間の役割分離
- プロジェクトの核心機能として維持
- ただし権限管理は簡素化

### 4.2 基本的なCRUD操作
- 最小限の機能として必要

### 4.3 Gemini API統合
- AI機能の基盤として必須

### 4.4 UIのリアルタイム更新
- ユーザー体験の快適性に必要
- WebSocketで実装（簡素化版）

---

## 5. 実行計画

### Phase 1: 削除作業（Day 1）
| タスク | 対象 | 作業内容 |
|--------|------|----------|
| JWT削除 | 2ファイル | 該当行の削除、関連参照の削除 |
| セッション削除 | 1ファイル | テーブル定義、設計セクション削除 |
| マルチテナント削除 | 全ファイル | 文字列置換 |

### Phase 2: 簡素化作業（Day 2）
| タスク | 対象 | 作業内容 |
|--------|------|----------|
| WebSocket調整 | backend-architecture.md | バランス実装に書き換え |
| Redis調整 | 技術仕様書 | キャッシュ用途のみに変更 |
| RBAC簡素化 | API仕様書 | 4役割に削減 |

### Phase 3: 文書更新（Day 3）
| タスク | 対象 | 作業内容 |
|--------|------|----------|
| 整合性確認 | 全ドキュメント | 削除・簡素化の反映確認 |
| 新設計書作成 | 新規 | SIMPLIFIED_LOCAL_DESIGN.md |
| 実装計画更新 | implementation-plan.md | 簡素化を反映 |

---

## 6. 影響範囲分析

### 6.1 削除による影響
| 削除項目 | 影響ファイル数 | リスク | 対策 |
|---------|--------------|--------|------|
| JWT認証 | 5-7ファイル | 低 | 自動起動で代替 |
| セッション管理 | 3-4ファイル | 低 | 不要 |
| マルチテナント | 10+ファイル | 低 | 単純置換 |

### 6.2 簡素化による効果
- **開発工数**: 40-50%削減
- **複雑度**: 60-70%削減
- **保守性**: 大幅向上
- **実装可能性**: 現実的なレベルに

---

## 7. 確認チェックリスト

### 削除前確認
- [ ] 前提条件（01-project-overview.md）との整合性確認
- [ ] 削除対象の依存関係確認
- [ ] バックアップ作成

### 削除後確認
- [ ] ドキュメント間の整合性
- [ ] 参照エラーがないこと
- [ ] 設計の一貫性

### 最終確認
- [ ] ユーザー体験への影響なし
- [ ] プロジェクトの核心機能の維持
- [ ] 実装可能性の向上

---

## 8. リスクと対策

### 8.1 識別されたリスク
| リスク | 発生確率 | 影響度 | 対策 |
|--------|----------|--------|------|
| 必要機能の誤削除 | 低 | 高 | 段階的削除、レビュー |
| 整合性の破綻 | 中 | 中 | 全文検索での確認 |
| 将来拡張性の喪失 | 低 | 低 | 基本構造は維持 |

### 8.2 ロールバック計画
- Gitでの変更管理
- 段階的なコミット
- 各フェーズでの動作確認

---

## 9. 期待される成果

### 9.1 定量的成果
- **ドキュメント量**: 30-40%削減
- **実装必要機能**: 50%削減
- **開発期間**: 6-8週間 → 3-4週間

### 9.2 定性的成果
- 理解しやすい設計
- 実装しやすい構造
- 保守しやすいコード
- 現実的なプロジェクト

---

**この計画により、プロジェクトをローカル・シングルユーザー環境に最適化し、実装可能性を大幅に向上させます。**

*作成者: 中野五月（Claude Code）*